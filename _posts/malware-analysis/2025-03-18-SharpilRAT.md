---
title: Malware analysis - Sharpil RAT (Infostealer Series)
classes: wide
header:
  teaser: /assets/images/MA/SharpilRat/sharpilrat.png
ribbon: MidnightBlue
categories:
  - Malware-analysis
toc: true
---

# Background
The Russian-speaking cybercrime underworld has been on the rise for several years now. This multi-million-dollar market attracts hundreds of individuals with varying levels of malware development skills.

As shown by [Anna Lvova on gdata.pt](https://www.gdata.pt/blog/2024/04/37894-sharp-info-stealer) this early stage Remote Access Trojan sample with Infostealer capabilities was first reported on April 17, 2024 by [Yogesh Londhe on X](https://x.com/suyog41/status/1780492021846921503). It features a limited set of functionalities and virtually no obfuscation. According to [Cybersecsentinel](https://cybersecsentinel.com/sharpil-rat-malware/), it has been distributed via phishing emails, deceptive Ads and through CVE exploitation.
<p align="center">
  <img src="\assets\images\MA\SharpilRat\1.png" />
</p>
<center><font size="3"> <u>Figure</u>(1): The Telegram channel of Sharp Stealer. The price, at the time of gdata’s post, was 10$ (rent) and $30 (life-time) (via gdata.pt)<u></u> </font></center>
<br>

It seems to be linked to the Sharpil Stealer, which we were unable to analyze due to the sample being unavailable.

# Static Analysis
<p align="center">
  <img src="\assets\images\MA\SharpilRat\2.png" />
</p>
<center><font size="3"> <u>Figure</u>(2): PE file, C#/.NET binary, 5.5 entropy <u></u> </font></center>
<br>

## Strings

<p align="center">
  <img src="\assets\images\MA\SharpilRat\3.png" />
</p>
<center><font size="3"> <u>Figure</u>(3)  <u></u> </font></center>
<br>

As a C#/.NET binary, we can try our luck and search for deobfuscated URLs/domains. Grepping for “http”, we immediately find a telegram “bot” URL, an API URL for a minecraft server provider (vimeworld) and multiple IP retrieval APIs.
## Imports

<p align="center">
  <img src="\assets\images\MA\SharpilRat\4.png" />
</p>
<center><font size="3"> <u>Figure</u>(4) <u></u> </font></center>
<br>

On the Import table, besides the http related functions, we also find process enumeration methods, cookie, VPN and social networks related functions, among others.

## Code Analysis
On the main function, we can see it is downloading a string from a Telegram bot (C&C), which represents the actual commands being received from the operator.
<p align="center">
  <img src="\assets\images\MA\SharpilRat\5.png" />
</p>
<center><font size="3"> <u>Figure</u>(5): Loop listening to the operator received commands <u></u> </font></center>
<br>

### Commands
Let’s analyze the RAT’s functionalities based on the commands it can receive and process: Browser, System, Return, Exit, Show Command

- **Browser**

<p align="center">
  <img src="\assets\images\MA\SharpilRat\6.png" />
</p>
<center><font size="3"> <u>Figure</u>(6)<u></u> </font></center>
<br>
It verifies if multiple browser folders exist on the LocalData or AppData. If they exist, it sends a message to the operator. It is not exfiltrating any relevant file, credential or data from it at this point.

- **System**

Fetches System info (OS version, host name, username, processor id, cpu name, gpu name, mac address, bios caption, and more) plus clipboard data.
<p align="center">
  <img src="\assets\images\MA\SharpilRat\7.png" />
</p>
<center><font size="3"> <u>Figure</u>(7) <u></u> </font></center>
<br>
<p align="center">
  <img src="\assets\images\MA\SharpilRat\8.png" />
</p>
<center><font size="3"> <u>Figure</u>(8) <u></u> </font></center>
<br>
That data is written to a file called “Information.txt”, which will be sent to the Telegram C2.
<p align="center">
  <img src="\assets\images\MA\SharpilRat\9.png" />
</p>
<center><font size="3"> <u>Figure</u>(9) <u></u> </font></center>
<br>

- **Return**

It resets/restarts the RAT.
<p align="center">
  <img src="\assets\images\MA\SharpilRat\10.png" />
</p>
<center><font size="3"> <u>Figure</u>(10) <u></u> </font></center>
<br>

- **Exit**
  
Terminates the process.
<p align="center">
  <img src="\assets\images\MA\SharpilRat\11.png" />
</p>
<center><font size="3"> <u>Figure</u>(11) <u></u> </font></center>
<br>

- **Show command**

It functions as the `--help` flag, listing all the commands that the RAT accepts.
<p align="center">
  <img src="\assets\images\MA\SharpilRat\12.png" />
</p>
<center><font size="3"> <u>Figure</u>(12) <u></u> </font></center>
<br>

### Exilftration
Two methods allow the RAT to exfiltrate data.
- SendMessage method's purpose is to exfiltrate "string" data to the Telegram bot.
<p align="center">
  <img src="\assets\images\MA\SharpilRat\13.png" />
</p>
<center><font size="3"> <u>Figure</u>(13) <u></u> </font></center>
<br>

- SenderAPI.POST is used when it needs to exfiltrate actual file data.
<p align="center">
  <img src="\assets\images\MA\SharpilRat\14.png" />
</p>
<center><font size="3"> <u>Figure</u>(14) <u></u> </font></center>
<br>

### Indications of Further Feature Development
This particular version is extremely simple and in an early stage. However, as we mentioned earlier, the developer clearly intended to continue its development. This is evident from the presence of the “Counting” class, which references potential future targets such as cookies, passwords, credit cards, bookmarks, Steam cookies, wallets, and many others.
<p align="center">
  <img src="\assets\images\MA\SharpilRat\15.png" />
</p>
<center><font size="3"> <u>Figure</u>(15) <u></u> </font></center>
<br>

# Basic Dynamic Analysis
Observing the network traffic and the process activity, there is the call - multiple calls actually, given it is in a loop - to the Telegram API (https) 
<p align="center">
  <img src="\assets\images\MA\SharpilRat\16.png" />
</p>
<center><font size="3"> <u>Figure</u>(16) <u></u> </font></center>
<br>
<p align="center">
  <img src="\assets\images\MA\SharpilRat\17.png" />
</p>
<center><font size="3"> <u>Figure</u>(17) <u></u> </font></center>
<br>

# IoCs
URLs: 
`hxxps://api.telegram[.]org/bot7057429288:AAHYl5_27YU1Yjmuj33WKOqLVSgYtq3n-8k/getUpdates`

SHA256: 
`1aae7dcfcb679f01938f1bfff990a87ccaaa9b9bed05ff85d64cdc7e925b83ef`
